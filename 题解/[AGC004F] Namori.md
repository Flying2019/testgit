### [链接](https://www.luogu.com.cn/problem/AT2046)
### 题目大意
给定一颗（基环）树，一开始所有点都是白色。每次可以选择一条两端点颜色相同的边，将两端点颜色反转。

要求把所有点变成黑色，问最小要几步。
### 题解
首先考虑树的情况。考虑“颜色相同”过于复杂，不妨将树按深度奇偶分层。由于根的位置无所谓，在树的情况下不妨钦定1是根。

不妨假设所有深度为奇数的点为“黑点”，那么要求就是选择一条两端点颜色不同的边，然后将两端点颜色互换。相当于黑色节点的移动。

不妨假设 $v_i$ 表示 $i$ 子树中的奇数深度的点与偶数深度的点的差。显然 $v_i$ 很好dp。

那么最后就是把所有在奇数节点上的黑点移动到偶数节点上面。所以可行的充要条件就是奇偶节点数相同，即 $v_1=0$。

考虑最小方案怎么构造？我们考虑对每个结点所在子树进行分析：要求每颗子树中的黑点数与偶深度节点数相同。我们不妨对于每条边考虑这条边上需要进行的操作数量。

显然，如果一颗子树的奇深度节点与偶深度节点数量不同，那么仅靠这颗子树内部移动是不可能完成的。那么我们考虑通过子树的根 $u$ 向 $u$ 的父亲送黑点/拿黑点。

具体来说，如果节点 $u$ 的一个儿子 $v$ 需要一个黑色节点，必然会从 $u$ 这里拿一个黑点。如果 $u$ 除了 $v$ 之外的其他子树中恰好完成，没有多余的黑点，那么 $u$ 就必须从 $u$ 的父亲拿1个黑点，对应一次操作。所以最后的答案就是每个子树中奇节点和偶节点的差的绝对值之和，即 $\displaystyle\sum_{i=1}^{n}{|v_i|}$。

接下来我们考虑基环树的情况。按照套路，我们先取出环的一条边按普通树跑一下。当然，这种情况下必须钦定取出边的一端为根 $rt$。

接下来还是对于环长的奇偶性分类讨论。对于偶数的情况，我们不妨假设这条边进行了 $x$ 次操作，可以发现，这个操作过后，所有环上除了 $rt$ 的所有点的权值都会 $-x$，即对应每个点的代价变成 $|v_i-x|$，特别的，虽然根的权值一直是0，但是我们可以认为它的权值也变成 $|0-x|$，因为这条边进行的操作本身也要记录代价。

那么题目要求变为 $\displaystyle\sum_{i\ \text{in circle}}{|v_i-x|}$ 最小。

这是一个典型问题，显然有 $x$ 是 $v_{i},i\ \text{in circle}$ 的中位数时最小（当然其实位于最中间两个数之间均可）。

再考虑奇环。那么我们考虑，加上这条边的本质时干了什么。

由于这条边链接的是“深度相同”的点，所以我们不能以“黑点的移动”来说明了。因为这条边要求边两端点颜色相同。

可以发现，这条边就是可以添加/删除偶数个黑点。特别的可以发现，这条边并不能减少任何步骤，只能把某些不可行的方案变成可行。

所以，这条边处理的次数就是 $\frac{v_{rt}}2$。当然如果原方案的最后结果是奇数，那么加了这条边也无济于事。

那么处理完 $d=\frac{v_{rt}}2$ 次之后，相当于环上少了 $d$ 的黑点，当然直接全部 $-d$ 即可。

复杂度 $O(n)$。
